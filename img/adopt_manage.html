<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ˜é¤ŠåˆŠç™»ç®¡ç†</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/myall.css">
    <link rel="stylesheet" href="css/color.css">
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <style>

#s01 i {
    color: var(--mycolor11); /* ä½¿ç”¨è®Šæ•¸ */}
        .s02-text {
            background-color: rgba(136, 49, 170, 0.2);
            padding: 5px;
        }
        .navbar-nav .nav-link {
            color:black; /* ä¿®æ”¹ç‚ºä½ æƒ³è¦çš„é¡è‰² */
        }
        .navbar-nav .nav-link:hover {
          color:var(--mycolor20); /* ç•¶æ»‘é¼ æ‡¸åœæ™‚çš„é¡è‰² */
        }
        .navbar-nav .nav-link.active {
            color:black; /* ä½¿ç”¨ !important ä¾†æé«˜å„ªå…ˆç´š */
    }

    #s03{
    border-bottom: 3px solid #633939; /* åœ¨åº•éƒ¨åŠ ä¸€æ¢ç·š */
    border-top: 3px solid #633939;
    border-left: 3px solid #633939; 
    border-right:3px solid #633939;
    padding-bottom: 20px; /* è®“å®ƒèˆ‡å…§å®¹æœ‰é»è·é›¢ */
    padding-top: 20px; /* èª¿æ•´æ•¸å€¼ä¾†å¢åŠ ä¸Šæ–¹ç©ºé–“ */
}
    </style>

</head>

<body class=>
 <!-- section 01 -->
 <section id="s01" style="background-color:#FFFAF2;" class="py-1">
    <div class="container">
        <div class="text-end">
            <a href="#"><i class="fa-brands fa-facebook-f pe-1 tx-03"></i></a>
            <a href="#"><i class="fa-brands fa-x-twitter pe-1 tx-03"></i></a>
            <a href="#"><i class="fa-brands fa-threads pe-1 tx-03"></i></a>
            <a href="#"><i class="fa-brands fa-line pe-1 tx-03"></i></a>
            <a href="#"><i class="fa-brands fa-instagram pe-1 tx-03"></i></a>
        </div>
    </div>
</section>

<section id="s02" class="bg-001">
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-001 navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fa fa-paw fa-regular fa-4x" style="color: #8b6f4f;"></i>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                        <li class="nav-item dropdown bg-002 ms-5">
                            <a class="nav-link" href="animals.html">
                                <i class="fa fa-heart-o nav-icon" aria-hidden="true"></i>
                                <span>é¦–é </span>
                            </a>
                        </li>
        
                        <li class="nav-item dropdown bg-002 ms-5">
                            <a class="nav-link" href="animal_data.html">
                                <i class="fa fa-heart-o nav-icon" aria-hidden="true"></i>
                                <span>å…¬ç«‹é ˜é¤Š</span>
                            </a>
                        </li>

                        <li class="nav-item dropdown bg-002 ms-5">
                            <a class="nav-link" href="animal_kw.html">
                                <i class="fa fa-heart-o nav-icon" aria-hidden="true"></i>
                                <span>æ°‘çœ¾é ˜é¤Š</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown bg-002 ms-5">
                            <a class="nav-link" href="animal_kw.html">
                                <i class="fa fa-heart-o nav-icon" aria-hidden="true"></i>
                                <span>å¯µç‰©å°çŸ¥è­˜</span>
                            </a>
                        </li>

                        <li id="public_adoption_nav" class="nav-item dropdown bg-002 ms-5 d-none">
                            <a class="nav-link" href="adopt_manage.html">
                                <i class="fa fa-heart-o nav-icon" aria-hidden="true"></i>
                                <span>é ˜é¤ŠåˆŠç™»ç®¡ç†</span>
                            </a>
                        </li>
                        
                        
                        <!-- <li class="nav-item dropdown">
                            <a class="nav-link fw-900 dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false" style="font-size: 22px;">
                                Dropdown
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item fw-900" href="#" style="font-size: 20px;">Action</a></li>
                                <li><a class="dropdown-item fw-900" href="#">Another action</a></li>
                                <li>
                                    <hr class="dropdown-divider fw-900" style="font-size: 22px;">
                                </li>
                                <li><a class="dropdown-item fw-900" href="#" style="font-size: 22px;">Something else here</a></li>
                            </ul>
                        </li> -->
                    </ul>
                    <div>
                       <!-- å¥—ç”¨ CSS è®Šæ•¸ --mycolor01 -->
                    <span class="h4 fw-900 me-3 d-none" id="s02_username_showtext" style="color: var(--mycolor09);">
                        æ­¡è¿æœƒå“¡: <span class="h3" id="s02_username_text">XXX</span>
                    </span>

                    <button class="btn" style="background-color: #f0e0da;" data-bs-toggle="modal" data-bs-target="#registerModal"
                        id="s02_reg_btn">è¨»å†Š</button>
                    <button class="btn bg-005" data-bs-toggle="modal" data-bs-target="#loginModal"
                        id="s02_login_btn">ç™»å…¥</button>
                    <button class="btn bg-003 d-none" id="s02_logout_btn">ç™»å‡º</button>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</section>



 <!-- registerModal -->
 <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-l">
        <div class="modal-content">
            <div class="modal-header bg-005" style="color: black;">
                <h1 class="modal-title fs-4 fw-900" id="exampleModalLabel">é ˜é¤Šäººè¨»å†Š</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-11">
                        <div class="mb-3">
                            <label for="username_reg" class="form-label">å¸³è™Ÿ</label>
                            <input type="text" class="form-control is-invalid" id="username_reg" name="username_reg"
                                placeholder="3-6å­—æ•¸">
                                <div class="valid-feedback" id="regModal_username_valid_feedback">ç¬¦åˆè¦å‰‡</div>
                                <div class="invalid-feedback" id="regModal_username_invalid_feedback">ä¸ç¬¦åˆè¦å‰‡</div>
                        </div>
                        <div class="mb-3">
                            <label for="password_reg" class="form-label">å¯†ç¢¼</label>
                            <input type="password" class="form-control is-invalid" id="password_reg"
                                name="password_reg" placeholder="3-6å­—æ•¸">
                            <div class="valid-feedback">ç¬¦åˆè¦å‰‡</div>
                            <div class="invalid-feedback">ä¸ç¬¦åˆè¦å‰‡</div>
                        </div>
                        <div class="mb-3">
                            <label for="re_password_reg" class="form-label">ç¢ºèªå¯†ç¢¼</label>
                            <input type="password" class="form-control is-invalid" id="re_password_reg"
                                name="re_password_reg">
                            <div class="valid-feedback">ç¬¦åˆè¦å‰‡</div>
                            <div class="invalid-feedback">ä¸ç¬¦åˆè¦å‰‡</div>
                        </div>
                        <div class="mb-3">
                            <label for="email_reg" class="form-label">Email</label>
                            <input type="email" class="form-control is-invalid" placeholder="3-10å­—æ•¸" id="email_reg"
                                name="email_reg">
                            <div class="valid-feedback">ç¬¦åˆè¦å‰‡</div>
                            <div class="invalid-feedback">ä¸ç¬¦åˆè¦å‰‡</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" style="background-color: #f0e0da;" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn bg-005" id="ok_btn_reg">ç¢ºèª</button>
            </div>
        </div>
    </div>
</div>

<!-- loginModal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-005">
                <h1 class="modal-title  fs-4 fw-900" id="exampleModalLabel">é ˜é¤Šäººç™»å…¥</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="username_login" class="form-label">å¸³è™Ÿ</label>
                    <input type="text" class="form-control is-invalid" id="username_login" name="username_login">
                    <div class="invalid-feedback">è«‹è¼¸å…¥å¸³è™Ÿ</div>
                </div>
                <div class="mb-3">
                    <label for="password_login" class="form-label">å¯†ç¢¼</label>
                    <input type="password" class="form-control is-invalid" id="password_login"
                        name="password_login">
                    <div class="invalid-feedback">è«‹è¼¸å…¥å¯†ç¢¼</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" style="background-color: #f0e0da;"  data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn bg-005" id="ok_btn_login">ç¢ºèª</button>
            </div>
        </div>
    </div>
</div>


<section class="bg-001 my-3 mx-3" id="s03">
    <h1 class="mb-4 text-center">é ˜é¤ŠåˆŠç™»ç®¡ç†é é¢</h1>
    <!-- æ–°å¢åˆŠç™»è¡¨å–® -->
    <form id="adoptForm" class="ms-3">
        <div class="mb-3">
            <label for="pet_name" class="form-label">å¯µç‰©åå­—</label>
            <input type="text" class="form-control" id="pet_name" name="pet_name" required>
        </div>
        <div class="mb-3">
            <label for="species" class="form-label">å“ç¨®</label>
            <input type="text" class="form-control" id="species" name="species" required>
        </div>
        <div class="mb-3">
            <label for="age" class="form-label">å¹´é½¡</label>
            <input type="number" class="form-control" id="age" name="age" required>
        </div>
        <div class="mb-3">
            <label for="gender" class="form-label">æ€§åˆ¥</label>
            <select class="form-select" id="gender" name="gender" required>
                <option value="å…¬">å…¬</option>
                <option value="æ¯">æ¯</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="location" class="form-label">æ‰€åœ¨åœ°</label>
            <input type="text" class="form-control" id="location" name="location" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">ç°¡å–®æè¿°</label>
            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
        </div>
        <!-- âœ… åœ–ç‰‡ä¸Šå‚³ -->
    <label for="animal_image">ä¸Šå‚³åœ–ç‰‡ï¼š</label>
    <input type="file" id="animal_image" name="animal_image" accept="image/*"><br>

    <!-- âœ… åœ–ç‰‡å³æ™‚é è¦½ -->
    <img id="previewImage" src="/web202411/imgs/placeholder.jpg" alt="åœ–ç‰‡é è¦½" style="max-width: 200px; display: none;"><br>
    
        <button type="submit" class="btn btn-primary">æ–°å¢åˆŠç™»</button>
    </form>
    </section>

    <hr class="my-5">

    <!-- å·²åˆŠç™»è³‡æ–™åˆ—è¡¨ -->
    <h2 class="mb-4">ğŸ“‹ å·²åˆŠç™»çš„å¯µç‰©</h2>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>åå­—</th>
                <th>å“ç¨®</th>
                <th>å¹´é½¡</th>
                <th>æ€§åˆ¥</th>
                <th>æ‰€åœ¨åœ°</th>
                <th>æè¿°</th>
                <th>åœ–ç‰‡</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="adoptList">
            <!-- åˆŠç™»è³‡æ–™æœƒé€é JS ç”Ÿæˆ -->
        </tbody>
    </table>


    
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

 // å³æ™‚ç›£è½username_reg
 $("#username_reg").bind("input propertychange", function () {
                if ($(this).val().length > 2 && $(this).val().length < 7) {
                    var JSONdata = { username: $("#username_reg").val() };
                    $.ajax({
                        type: "POST",
                        url: "ani_member_control_api_v1.php?action=checkuni",
                        data: JSON.stringify(JSONdata),
                        dataType: "json",
                        success: showdata_checkuni,
                        error: function () {
                            Swal.fire({
                                title: "APIä»‹æ¥éŒ¯èª¤?",
                                text: "ani_member_control_api_v1.php?action=checkuni",
                                icon: "error"
                            });
                        }
                    });
                } else {
                    $(this).removeClass("is-valid").addClass("is-invalid");
                    $("#regModal_username_invalid_feedback").text("å¸³è™Ÿé•·åº¦éœ€ä»‹æ–¼ 3-6 å­—å…ƒï¼");
                    flag_username_reg = false;
                }
            });

           // å³æ™‚ç›£è½å¯†ç¢¼è¼¸å…¥æ¡†
$("#password_reg").on("input", function () {
    let password = $(this).val();
    if (password.length >= 2) { // åªè¦2å€‹å­—ä»¥ä¸Š
        $(this).removeClass("is-invalid").addClass("is-valid");
    } else {
        $(this).removeClass("is-valid").addClass("is-invalid");
    }
});

// å³æ™‚ç›£è½ç¢ºèªå¯†ç¢¼è¼¸å…¥æ¡†
$("#re_password_reg").on("input", function () {
    let password = $("#password_reg").val();
    let rePassword = $(this).val();
    if (rePassword === password && rePassword.length >= 2) { // å¯†ç¢¼ä¸€è‡´ä¸”2å­—ä»¥ä¸Š
        $(this).removeClass("is-invalid").addClass("is-valid");
    } else {
        $(this).removeClass("is-valid").addClass("is-invalid");
    }
});

// å³æ™‚ç›£è½Emailè¼¸å…¥æ¡†
$("#email_reg").on("input", function () {
    let email = $(this).val();
    if (email.length >= 2) { // åªè¦2å€‹å­—ä»¥ä¸Š
        $(this).removeClass("is-invalid").addClass("is-valid");
    } else {
        $(this).removeClass("is-valid").addClass("is-invalid");
    }
});

$("#ok_btn_reg").on("click", function () {
    let username = $("#username_reg").val();
    let password = $("#password_reg").val();
    let rePassword = $("#re_password_reg").val();
    let email = $("#email_reg").val();

    if (!username || !password || !rePassword || !email) {
        Swal.fire("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼");
        return;
    }

    if (password !== rePassword) {
        Swal.fire("å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´ï¼");
        return;
    }

    let JSONdata = { username, password, email };

    $.ajax({
        type: "POST",
        url: "ani_member_control_api_v1.php?action=register",
        data: JSON.stringify(JSONdata),
        dataType: "json",
        success: function (response) {
            if (response.state) {
                Swal.fire({
                    title: "è¨»å†ŠæˆåŠŸï¼",
                    text: "æ­¡è¿ " + response.data.Username,
                    icon: "success"
                }).then(() => {
                    $("#registerModal").modal("hide");
                    location.reload(); // é‡æ–°æ•´ç†é é¢
                });
            } else {
                Swal.fire({
                    title: "è¨»å†Šå¤±æ•—",
                    text: response.message,
                    icon: "error"
                });
            }
        },
        error: function () {
            Swal.fire("API éŒ¯èª¤", "ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨", "error");
        }
    });
});
    
            // ok_btn_login æŒ‰éˆ•ç›£è½
            $("#ok_btn_login").on("click", function () {
                var loginData = {
                    username: $("#username_login").val(),
                    password: $("#password_login").val()
                };
    
                $.ajax({
                    type: "POST",
                    url: "ani_member_control_api_v1.php?action=login",
                    data: JSON.stringify(loginData),
                    contentType: "application/json",
                    dataType: "json",
                    success: function (response) {
                        if (response.state) {
                            Swal.fire({
                                title: "ç™»å…¥æˆåŠŸï¼",
                                text: "æ­¡è¿å›ä¾†ï¼Œ" + response.data.Username,
                                icon: "success"
                            }).then(() => {
                                setCookie("Uid01", response.data.Uid01, 7);
                                updateUI(true, response.data.Username);
                                $("#loginModal").modal("hide");
                            });
                        } else {
                            Swal.fire({
                                title: "ç™»å…¥å¤±æ•—",
                                text: response.message,
                                icon: "error"
                            });
                        }
                    },
                    error: function (xhr) {
                        Swal.fire({
                            title: "éŒ¯èª¤",
                            text: "ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ã€‚",
                            icon: "error"
                        });
                    }
                });
            });
    
        // æ¸…é™¤æŒ‡å®šçš„ Cookie
function clearCookie(cname) {
    document.cookie = cname + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
}

// ç™»å‡ºæŒ‰éˆ•ç›£è½
$("#s02_logout_btn").click(function () {
    var JSONdata = JSON.stringify({ uid01: getCookie("Uid01") });
    console.log("ç™¼é€è‡³å¾Œç«¯çš„ JSONdataï¼š", JSONdata);

    $.ajax({
        type: "POST",
        url: "ani_member_control_api_v1.php?action=logout",
        data: JSONdata,
        contentType: "application/json",
        dataType: "json",
        success: function (response) {
            console.log("å¾Œç«¯å›æ‡‰ï¼š", response);

            if (response.state) {
                // æ¸…é™¤ Cookie
                clearCookie("Uid01");

                // æ›´æ–°ä»‹é¢
                updateUI(false);

                // æç¤ºç™»å‡ºæˆåŠŸ
                Swal.fire({
                    title: "å·²ç™»å‡º",
                    icon: "success"
                }).then(() => {
                    location.reload();
                });
            } else {
                Swal.fire({
                    title: "ç™»å‡ºå¤±æ•—",
                    text: response.message || "ç™»å‡ºæ™‚ç™¼ç”ŸéŒ¯èª¤",
                    icon: "error"
                });
            }
        },
        error: function (xhr) {
            console.error("ç™»å‡ºè«‹æ±‚å¤±æ•—", xhr.responseText);
            Swal.fire({
                title: "éŒ¯èª¤",
                text: "ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ã€‚",
                icon: "error"
            });
        }
    });
});

            // æª¢æŸ¥å¸³è™Ÿæ˜¯å¦é‡è¤‡çš„å›æ‡‰è™•ç†
function showdata_checkuni(data) {
    console.log("æª¢æŸ¥å¸³è™Ÿé‡è¤‡å›æ‡‰:", data);

    if (data.state) {
        $("#username_reg").removeClass("is-invalid").addClass("is-valid");
        $("#regModal_username_valid_feedback").text(data.message);
    } else {
        $("#username_reg").removeClass("is-valid").addClass("is-invalid");
        $("#regModal_username_invalid_feedback").text(data.message);
    }
}

$(document).ready(function () {
    checkLoginStatus();
});

// æª¢æŸ¥ç™»å…¥ç‹€æ…‹
function checkLoginStatus() {
    var uid = getCookie("Uid01");
    console.log("æª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼ŒUid01:", uid);

    if (uid) {
        // é€éå¾Œç«¯ç¢ºèª uid æ˜¯å¦æœ‰æ•ˆ
        $.ajax({
            type: "POST",
            url: "ani_member_control_api_v1.php?action=checkuid",
            data: JSON.stringify({ uid01: uid }),
            contentType: "application/json",
            dataType: "json",
            success: function (response) {
                console.log("å¾Œç«¯å›æ‡‰:", response);
                if (response.state) {
                    updateUI(true, response.data.Username);
                } else {
                    updateUI(false);
                    showLoginAlert(); // æ²’æœ‰ç™»å…¥æˆ–å¤±æ•ˆå‰‡æç¤º
                }
            },
            error: function () {
                console.error("æª¢æŸ¥ç™»å…¥ç‹€æ…‹å¤±æ•—");
                updateUI(false);
                showLoginAlert(); // å¦‚æœå¾Œç«¯æ²’å›æ‡‰ä¹Ÿæç¤º
            }
        });
    } else {
        updateUI(false);
        showLoginAlert(); // æ²’æœ‰ Uid01 æ™‚ç›´æ¥æç¤º
    }
}
    
            // æ›´æ–° UI        
function updateUI(isLoggedIn, username = "") {
    if (isLoggedIn) {
        // é¡¯ç¤ºç™»å…¥å¾Œæ‰æœƒå‡ºç¾çš„é …ç›®
        $("#s02_reg_btn, #s02_login_btn").addClass("d-none");
        $("#s02_logout_btn, #s02_username_showtext, #s02_control_panel_btn").removeClass("d-none");
        $("#public_adoption_nav").removeClass("d-none"); // é¡¯ç¤ºå…¬ç«‹é ˜é¤Šé¸å–®
        $("#s02_username_text").text(username);
    } else {
        // ç™»å‡ºå¾Œéš±è—é¸å–®
        $("#s02_reg_btn, #s02_login_btn").removeClass("d-none");
        $("#s02_logout_btn, #s02_username_showtext, #s02_control_panel_btn").addClass("d-none");
        $("#public_adoption_nav").addClass("d-none"); // éš±è—å…¬ç«‹é ˜é¤Šé¸å–®
        $("#s02_username_text").text("");
    }
}

// SweetAlert æç¤ºæ¡†
function showLoginAlert() {
    Swal.fire({
        title: "è«‹å…ˆç™»å…¥æœƒå“¡ï¼",
        text: "ç™»å…¥å¾Œæ‰å¯ä»¥ä½¿ç”¨é ˜é¤ŠåˆŠç™»åŠŸèƒ½ï¼",
        icon: "info",
        confirmButtonText: "ç¢ºå®š"
    });
}

    
            // è¨­å®š Cookie
            function setCookie(cname, cvalue, exdays) {
                const d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                document.cookie = `${cname}=${cvalue};expires=${d.toUTCString()};path=/`;
            }
    
            // å–å¾— Cookie
            function getCookie(cname) {
                let name = cname + "=";
                let ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i].trim();
                    if (c.indexOf(name) === 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }
    
    //////////////////////////

    $(document).ready(function () {
    $("#adoptForm").on("submit", function (e) {
        e.preventDefault();
        let formData = new FormData(this);

        // âœ… å¾ Cookie å–å¾— Uid01
        const Uid01 = getCookie("Uid01");
        console.log("å‰ç«¯æŠ“åˆ°çš„ Uid01ï¼š", Uid01);

        if (!Uid01) {
            Swal.fire("éŒ¯èª¤ï¼", "è«‹å…ˆç™»å…¥æ‰èƒ½åˆŠç™»å‹•ç‰©è³‡æ–™ï¼", "error");
            return; // æ²’æœ‰ç™»å…¥å‰‡é˜»æ­¢æäº¤
        }

        formData.append('Uid01', Uid01); // å‚³çµ¦å¾Œç«¯

        // âœ… æª¢æŸ¥é€å‡ºçš„è³‡æ–™
        for (let [key, value] of formData.entries()) {
            console.log(`${key}: ${value}`);
        }

        $.ajax({
            type: "POST",
            url: "adopt_manage_api.php?action=add",
            data: formData,
            contentType: false,
            processData: false,
            dataType: "json",
            success: function (response) {
                console.log("å¾Œç«¯å›æ‡‰ï¼š", response);
                if (response.state) {
                    Swal.fire("æˆåŠŸï¼", "å‹•ç‰©è³‡æ–™å·²æ–°å¢ï¼", "success");
                    loadAnimalList();
                    $("#adoptForm")[0].reset();
                } else {
                    Swal.fire("éŒ¯èª¤ï¼", response.message, "error");
                }
            },
            error: function () {
                Swal.fire("éŒ¯èª¤ï¼", "ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ã€‚", "error");
            }
        });
    });

 // âœ… æ­£ç¢ºè¼‰å…¥å·²åˆŠç™»çš„å¯µç‰©è³‡æ–™
 // âœ… è¼‰å…¥ä¸¦é¡¯ç¤ºå‹•ç‰©è³‡æ–™
function loadAnimalList() {
    $.ajax({
        type: "GET",
        url: "adopt_manage_api.php?action=list",
        dataType: "json",
        success: function (data) {
            console.log("å¾Œç«¯å›å‚³çš„å‹•ç‰©è³‡æ–™ï¼š", data);

            const adoptList = $("#adoptList");
            adoptList.empty();

            if (!Array.isArray(data) || data.length === 0) {
                adoptList.append('<tr><td colspan="8" class="text-center">ç›®å‰æ²’æœ‰ä»»ä½•åˆŠç™»çš„å‹•ç‰©ã€‚</td></tr>');
                return;
            }

            data.forEach(animal => {
                const imageUrl = animal.image_url ? animal.image_url : '/web202411/imgs/placeholder.jpg';
                const row = `
                    <tr>
                        <td>${animal.pet_name}</td>
                        <td>${animal.species}</td>
                        <td>${animal.age ?? 'æœªå¡«å¯«'}</td>
                        <td>${animal.gender}</td>
                        <td>${animal.location ?? 'æœªå¡«å¯«'}</td>
                        <td>${animal.description ?? 'ç„¡'}</td>
                        <td>
                            <img src="${imageUrl}" alt="å‹•ç‰©åœ–ç‰‡" style="width: 80px; height: 80px;"
                            onerror="this.onerror=null; this.src='/web202411/imgs/placeholder.jpg';">
                        </td>
                        <td><button class="btn btn-danger btn-sm" onclick="deleteAnimal(${animal.id})">åˆªé™¤</button></td>
                    </tr>
                `;
                adoptList.append(row);
            });
        },
        error: function (xhr) {
            console.error("è¼‰å…¥å‹•ç‰©è³‡æ–™å¤±æ•—ï¼š", xhr.responseText);
            Swal.fire("éŒ¯èª¤ï¼", "ç„¡æ³•è¼‰å…¥å‹•ç‰©è³‡æ–™ã€‚", "error");
        }
    });
}


    // âœ… ç­‰å¾… DOM è¼‰å…¥å¾ŒåŸ·è¡Œ
    $(document).ready(function () {
        loadAnimalList();
    });

      // ğŸ—‘ï¸ åˆªé™¤å‹•ç‰©è³‡æ–™
      window.deleteAnimal = function (id) {
        $.ajax({
            type: "POST",
            url: "adopt_manage_api.php?action=delete",
            data: { id },
            dataType: "json",
            success: function (response) {
                if (response.state) {
                    Swal.fire("å·²åˆªé™¤ï¼", "è³‡æ–™å·²æˆåŠŸåˆªé™¤ã€‚", "success");
                    loadAnimalList();
                } else {
                    Swal.fire("éŒ¯èª¤ï¼", response.message, "error");
                }
            },
            error: function () {
                Swal.fire("éŒ¯èª¤ï¼", "ç„¡æ³•åˆªé™¤è³‡æ–™ã€‚", "error");
            }
        });
    };

    // åˆå§‹åŒ–è³‡æ–™
    loadAnimalList();
});


    </script>

</body>

</html>
